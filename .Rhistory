qog2009_c = merge(issp_countries, qog2009, by = c("v5"))
dim(qog2009_c)
colSums(is.na(qog2009_c))
# Eliminar columnas con máximo 5 NAs
qog2009_c_na = qog2009_c[, colSums(is.na(qog2009_c)) < 6]
qog2009_c_na = qog2009_c_na %>% dplyr::select("v5", "fi_index") %>% as.data.frame()
#names(qog2009_c_na)
# Chunk 39
mer_pref <- merge(mer_pref, qog2009_c_na, by=c("v5"))
# Chunk 40
library(readxl)
pibpc <- read_excel("input/data/original/pibpc.xls", sheet = "Data")
View(pibpc)
pibpc$v5c<-pibpc$CountryCode
pibpc$pibpc <- pibpc$`PIB per cápita (US$ a precios actuales)`
mer_pref <- merge(mer_pref, pibpc, by=c("v5c"))
summary(mer_pref$pibpc)
# Chunk 41
save(mer_pref, file="input/data/proc/mer_pref.rda")
# Chunk 42
#mer_pref_polycor <- mer_pref %>% dplyr::select(
#"j_redist", "j_accum" , #"j_merit","j_unmerit","j_bmerit","j_need",".dots...gini_disp",".dots...gini_mkt","fi_index", #"pibpc", "redis_relativo")
#save(mer_pref_polycor, file ="input/data/proc/mer_pref_polycor.rda")
View(qog)
View(qog2009_c)
names(qog2009_c_na)
names(qog2009_c)
load( file = "input/data/original/qog.rda")
View(qog)
sjPlots::view_df(qog2009_c_na)
sjPlot::view_df(qog2009_c_na)
sjPlot::view_df(qog)
hist(qog$sgi_ectx)
hist(qog$sgi_sogi)
hist(qog$sgi_ectx)
hist(qog$sgi_sogi)
load(file = "input/data/original/issp.rda")
sjPlot::view_df(issp2009)
sjPlot::view_df(qog2009)
load( file = "input/data/original/qog.rda")
#load(url('https://raw.githubusercontent.com/franciscomeneses/bases/master/qog.rda'))
# Extract 2009 data
qog2009 = subset(qog, year == 2009)
# hist(qog$sgi_ectx) # Desempeño de las políticas: políticas económicas - impuestos
# hist(qog$sgi_sogi) # Desempeño de las políticas: Políticas sociales - Desigualdades sociales globales
# Merge with ISSP countries for cleaning
load("input/data/proc/indepvar_contries.rda")
issp_countries =	aggregate(indepvar_contries[c("v5")],
list(indepvar_contries$country, indepvar_contries$v5c),
mean)
qog2009[c("ccode", "cname")] # check ISO codes
names(qog2009)[names(qog2009) == 'ccode'] <- 'v5'
qog2009_c = merge(issp_countries, qog2009, by = c("v5"))
dim(qog2009_c)
colSums(is.na(qog2009_c))
# Eliminar columnas con máximo 5 NAs
qog2009_c_na = qog2009_c[, colSums(is.na(qog2009_c)) < 6]
load( file = "input/data/original/qog.rda")
#load(url('https://raw.githubusercontent.com/franciscomeneses/bases/master/qog.rda'))
# Extract 2009 data
qog2009 = subset(qog, year == 2009)
# hist(qog$sgi_ectx) # Desempeño de las políticas: políticas económicas - impuestos
# hist(qog$sgi_sogi) # Desempeño de las políticas: Políticas sociales - Desigualdades sociales globales
# Merge with ISSP countries for cleaning
load("input/data/proc/indepvar_contries.rda")
issp_countries =	aggregate(indepvar_contries[c("v5")],
list(indepvar_contries$country, indepvar_contries$v5c),
mean)
qog2009[c("ccode", "cname")] # check ISO codes
names(qog2009)[names(qog2009) == 'ccode'] <- 'v5'
qog2009_c = merge(issp_countries, qog2009, by = c("v5"))
dim(qog2009_c)
colSums(is.na(qog2009_c))
# Eliminar columnas con máximo 5 NAs
#qog2009_c_na = qog2009_c[, colSums(is.na(qog2009_c)) < 6]
qog2009_c_na = qog2009_c_na %>% dplyr::select("v5", "fi_index", "sgi_ectx", "sgi_sogi") %>% as.data.frame()
load( file = "input/data/original/qog.rda")
#load(url('https://raw.githubusercontent.com/franciscomeneses/bases/master/qog.rda'))
# Extract 2009 data
qog2009 = subset(qog, year == 2009)
# hist(qog$sgi_ectx) # Desempeño de las políticas: políticas económicas - impuestos
# hist(qog$sgi_sogi) # Desempeño de las políticas: Políticas sociales - Desigualdades sociales globales
# Merge with ISSP countries for cleaning
load("input/data/proc/indepvar_contries.rda")
issp_countries =	aggregate(indepvar_contries[c("v5")],
list(indepvar_contries$country, indepvar_contries$v5c),
mean)
qog2009[c("ccode", "cname")] # check ISO codes
names(qog2009)[names(qog2009) == 'ccode'] <- 'v5'
qog2009_c = merge(issp_countries, qog2009, by = c("v5"))
dim(qog2009_c)
colSums(is.na(qog2009_c))
# Eliminar columnas con máximo 5 NAs
#qog2009_c_na = qog2009_c[, colSums(is.na(qog2009_c)) < 6]
qog2009_c_na = qog2009_c %>% dplyr::select("v5", "fi_index", "sgi_ectx", "sgi_sogi") %>% as.data.frame()
mer_pref <- merge(mer_pref, qog2009_c_na, by=c("v5"))
hits(mer_pref$sgi_ectx
hits(mer_pref$sgi_ectx)
hist(mer_pref$sgi_ectx)
table(mer_pref$sgi_ectx)
View(qog2009_c_na)
table(qog$year)
load( file = "input/data/original/qog.rda")
#load(url('https://raw.githubusercontent.com/franciscomeneses/bases/master/qog.rda'))
# Extract 2009 data
qog2009 = subset(qog, year == 2010)
# hist(qog$sgi_ectx) # Desempeño de las políticas: políticas económicas - impuestos
# hist(qog$sgi_sogi) # Desempeño de las políticas: Políticas sociales - Desigualdades sociales globales
# Merge with ISSP countries for cleaning
load("input/data/proc/indepvar_contries.rda")
issp_countries =	aggregate(indepvar_contries[c("v5")],
list(indepvar_contries$country, indepvar_contries$v5c),
mean)
qog2009[c("ccode", "cname")] # check ISO codes
names(qog2009)[names(qog2009) == 'ccode'] <- 'v5'
qog2009_c = merge(issp_countries, qog2009, by = c("v5"))
dim(qog2009_c)
colSums(is.na(qog2009_c))
# Eliminar columnas con máximo 5 NAs
qog2009_c_na = qog2009_c[, colSums(is.na(qog2009_c)) < 6]
qog2009_c_na = qog2009_c %>% dplyr::select("v5", "fi_index") %>% as.data.frame()
# "sgi_ectx", "sgi_sogi" # Hasta ahora no hay valores, parece no haber para el 2009.
table(mer_pref$sgi_ectx)
mer_pref <- merge(mer_pref, qog2009_c_na, by=c("v5"))
table(mer_pref$sgi_ectx)
load( file = "input/data/original/qog.rda")
#load(url('https://raw.githubusercontent.com/franciscomeneses/bases/master/qog.rda'))
# Extract 2009 data
qog2009 = subset(qog, year == 2010)
# hist(qog$sgi_ectx) # Desempeño de las políticas: políticas económicas - impuestos
# hist(qog$sgi_sogi) # Desempeño de las políticas: Políticas sociales - Desigualdades sociales globales
# Merge with ISSP countries for cleaning
load("input/data/proc/indepvar_contries.rda")
issp_countries =	aggregate(indepvar_contries[c("v5")],
list(indepvar_contries$country, indepvar_contries$v5c),
mean)
qog2009[c("ccode", "cname")] # check ISO codes
names(qog2009)[names(qog2009) == 'ccode'] <- 'v5'
qog2009_c = merge(issp_countries, qog2009, by = c("v5"))
dim(qog2009_c)
colSums(is.na(qog2009_c))
# Eliminar columnas con máximo 5 NAs
qog2009_c_na = qog2009_c[, colSums(is.na(qog2009_c)) < 6]
qog2009_c_na = qog2009_c %>% dplyr::select("v5", "fi_index", "sgi_ectx") %>% as.data.frame()
# "sgi_ectx", "sgi_sogi" # Hasta ahora no hay valores, parece no haber para el 2009.
table(qog2009_c_na$sgi_ectx)
load( file = "input/data/original/qog.rda")
#load(url('https://raw.githubusercontent.com/franciscomeneses/bases/master/qog.rda'))
# Extract 2009 data
qog2009 = subset(qog, year == 2008)
# hist(qog$sgi_ectx) # Desempeño de las políticas: políticas económicas - impuestos
# hist(qog$sgi_sogi) # Desempeño de las políticas: Políticas sociales - Desigualdades sociales globales
# Merge with ISSP countries for cleaning
load("input/data/proc/indepvar_contries.rda")
issp_countries =	aggregate(indepvar_contries[c("v5")],
list(indepvar_contries$country, indepvar_contries$v5c),
mean)
qog2009[c("ccode", "cname")] # check ISO codes
names(qog2009)[names(qog2009) == 'ccode'] <- 'v5'
qog2009_c = merge(issp_countries, qog2009, by = c("v5"))
dim(qog2009_c)
colSums(is.na(qog2009_c))
# Eliminar columnas con máximo 5 NAs
qog2009_c_na = qog2009_c[, colSums(is.na(qog2009_c)) < 6]
qog2009_c_na = qog2009_c %>% dplyr::select("v5", "fi_index", "sgi_ectx") %>% as.data.frame()
# "sgi_ectx", "sgi_sogi" # Hasta ahora no hay valores, parece no haber para el 2009.
mer_pref <- merge(mer_pref, qog2009_c_na, by=c("v5"))
table(mer_pref$sgi_ectx)
View(qog)
table(mer_pref$v5)
table(mer_pref$v5c)
table(mer_pref$v5)
table(mer_pref$v5c)
library(readxl)
Data_Extract_From_Indicadores_mundiales_de_buen_gobierno <- read_excel("input/data/original/Data_Extract_From_Indicadores_mundiales_de_buen_gobierno.xlsx")
View(Data_Extract_From_Indicadores_mundiales_de_buen_gobierno)
gov_effect <-
read_excel("input/data/original/Data_Extract_From_Indicadores_mundiales_de_buen_gobierno.xlsx")
gov_effect$v5c<-pibpc$"país Code"
library(readxl)
Data_Extract_From_Indicadores_mundiales_de_buen_gobierno <- read_excel("input/data/original/Data_Extract_From_Indicadores_mundiales_de_buen_gobierno.xlsx")
View(Data_Extract_From_Indicadores_mundiales_de_buen_gobierno)
gov_effect$v5c<-pibpc$`país Code`
gov_effect$v5c<-pibpc$`pais Code`
gov_effect$v5c<-pibpc$`paisCode`
gov_effect <- read_excel("input/data/original/Data_Extract_From_Indicadores_mundiales_de_buen_gobierno.xlsx")
gov_effect$v5c<-pibpc$`país Code`
gov_effect$v5c<-pibpc$`paiscode`
gov_effect$v5c<-gov_effect$`paiscode`
gov_effect$goveffect <- gov_effect$`2009 [YR2009]`
mer_pref <- merge(mer_pref, gov_effect, by=c("v5c"))
hist(mer_pref$goveffect)
gov_effect$goveffect <- as.numeric(gov_effect$`2009 [YR2009]`)
mer_pref <- merge(mer_pref, gov_effect, by=c("v5c"))
hist(mer_pref$goveffect)
# Chunk 2
knitr::opts_chunk$set(warning = FALSE,message = FALSE, cache = FALSE)
knitr::opts_knit$set(root.dir = "../")
options(scipen=999)
rm(list=ls())
options(knitr.kable.NA = '')
# Chunk 3
library(sjPlot)
library(sjmisc) # several functions,ej read_stata
library(descr)
library(memisc)  # codebook
library(psych) # cor2latex
library(corrplot) # graph correlations
library(lavaan)
library(stargazer)
library(semTools)
library(plyr) # count
library(dplyr)
library(car) # recode
library(ggplot2)
library(Hmisc)
library(tidyverse)
library(data.table)
library(stringr)
library(countrycode)
library(lme4)
library(texreg)
library(mice)
library(ggrepel) # for scatter labels in sjp.scatter
library(semPlot)
library(haven)
library(sjlabelled)
library(kableExtra)
library(ggeffects)
library(influence.ME)
library(lattice)
# Chunk 4
load(file = "input/data/proc/redistrib.rda")
load(file = "input/data/proc/mer_pref.rda")
load("input/data/proc/redistrib.rda")
load("input/data/proc/getahead.rda")
load("input/data/proc/detearn.rda")
# Chunk 5
load(file="input/data/proc/mer_pref.rda")
# Modelo nulo
results_0_redist = lmer(redist ~ 1 + (1| v5c), data = mer_pref, REML=F)
results_0_accum  = lmer(accum ~ 1 + (1| v5c), data = mer_pref, REML=F)
htmlreg(list(results_0_redist,results_0_accum),
caption = "null model of Redistributive preferences and accumulation preferences",
custom.model.names = c("Redistributive", "Accumulation"),
caption.adove = T, star.symbol = "\\*")
#reghelper::ICC(results_0_redist)
# Chunk 6
# Modelo nulo
# Correlacion intraclases accum
df<-data.frame(Variance=c("Between","Whithin"),
porcentaje=c(15,85))
ggplot(df,aes(x="",y=porcentaje, fill=Variance))+
geom_bar(stat = "identity",color="white")+
coord_polar(theta="y") +
geom_text(aes(label=paste(porcentaje, "%")),
position=position_stack(vjust=0.5),color="white",size=6)+
coord_polar(theta = "y") + ggtitle("Correlacion intraclase prederencias redistributivas")
reghelper::ICC(results_0_accum)
df<-data.frame(Variance=c("Between","Whithin"),
porcentaje=c(18,82))
ggplot(df,aes(x="",y=porcentaje, fill=Variance))+
geom_bar(stat = "identity",color="white")+
coord_polar(theta="y") +
geom_text(aes(label=paste(porcentaje, "%")),
position=position_stack(vjust=0.5),color="white",size=6)+
coord_polar(theta = "y") + ggtitle("Correlacion intraclase prederencias redistributivas")
# Chunk 7
results_1_redist__1  = lmer(redist ~  gini_neto + fi_index + pibpc + 1 + (1| v5c), data = mer_pref, REML=F)
results_1_redist_3 = lmer(redist ~ merit + 1 +  (1| v5c), data = mer_pref, REML=F)
results_1_redist_4 = lmer(redist ~  merit + bmerit + 1 +  (1| v5c), data = mer_pref, REML=F)
results_1_redist_5 = lmer(redist ~  merit + bmerit + unmerit + 1 +  (1| v5c), data = mer_pref, REML=F)
results_1_redist_6 = lmer(redist ~ merit + bmerit + unmerit + need + 1 +  (1| v5c), data = mer_pref, REML=F)
results_1_redist_7 = lmer(redist ~ gini_neto + fi_index + pibpc + merit + bmerit + unmerit + need + 1 +  (1| v5c), data = mer_pref, REML=F)
results_1_redist_9 = lmer(redist ~ gini_neto + fi_index + pibpc + merit + bmerit + unmerit + need + sstatus + as.factor(movstatus) + univ + as.factor(quintile_miss)  + sex + age  + 1 +  (1| v5c), data = mer_pref, REML=F)
results_2_redist_macro_bv = lmer(redist ~ univ + as.factor(quintile_miss) +	sstatus + as.factor(movstatus) + sex + age  + merit + bmerit + unmerit + need + gini_neto + fi_index + pibpc + 1 +  (1 + merit| v5c), data= mer_pref, REML=F)
results_3_redist_macro_bvi = lmer(redist ~ univ + as.factor(quintile_miss) +	sstatus + as.factor(movstatus) + sex + age  + merit + bmerit + unmerit + need + merit*gini_neto + fi_index + pibpc  + 1 +  (1 + merit| v5c), data = mer_pref, REML=F)
# Chunk 8
htmlreg(list(results_1_redist__1, results_1_redist_3,results_1_redist_4,results_1_redist_5,results_1_redist_6,results_1_redist_7, results_1_redist_9, results_2_redist_macro_bv, results_3_redist_macro_bvi),
caption = "Redistributive preference models",
omit.coef = "(sstatus)|(movstatus)|(univ)|(quintile_miss)|(age)|(sex)",
custom.coef.names = c("Intercept", "Gini index", "Economic freedom index", "PIB per capita", "Meritocratic perception",
"Meritocratic preference", "Unmeritocratic Perception","Unmerit preference", "GINI x Merit-perception"),
caption.above = T,
star.symbol = "\\*",
center = T,
custom.note = "$***p <$ 0.001, $**p <$ 0.01, $*p <$ 0.05 <br> Since Model 6 control by subjetive status, mov subjetive status, Ed.univ, quintile_miss, age and sex")
# Chunk 9
results_1_redist_dem  = lmer(redist ~ univ + as.factor(quintile_miss) +	sstatus + as.factor(movstatus) + sex + age + 1 + (1| v5c), data = mer_pref, REML=F)
results_1_redist_indsust = lmer(redist ~ univ + as.factor(quintile_miss) +	sstatus + as.factor(movstatus) + sex + age  + merit + bmerit + unmerit + need + 1 +  (1| v5c), data = mer_pref, REML=F)
results_1_redist_macro = lmer(redist ~ univ + as.factor(quintile_miss) +	sstatus + as.factor(movstatus) + sex + age  + merit + bmerit + unmerit + need + gini_neto + fi_index + 1 +  (1| v5c), data = mer_pref, REML=F)
results_2_redist_macro_bv = lmer(redist ~ univ + as.factor(quintile_miss) +	sstatus + as.factor(movstatus) + sex + age  + merit + bmerit + unmerit + need + gini_neto + fi_index + 1 +  (1 + merit| v5c), data= mer_pref, REML=F)
results_3_redist_macro_bvi = lmer(redist ~ univ + as.factor(quintile_miss) +	sstatus + as.factor(movstatus) + sex + age  + merit + bmerit + unmerit + need + merit*gini_neto + fi_index + 1 +  (1 + merit| v5c), data = mer_pref, REML=F)
results_3_redist_macro_bvi_2 = lmer(redist ~ univ + as.factor(quintile_miss) +	sstatus + as.factor(movstatus) + sex + age  + merit + bmerit + unmerit + need + merit*fi_index + gini_neto + 1 +  (1 + merit| v5c), data = mer_pref, REML=F)
#htmlreg(list(results_1_redist_macro,results_2_redist_macro_bv, results_3_redist_macro_bvi,results_3_redist_macro_bvi_2), caption = "Pendiente aleatorea e interaccion entre niveles", omit.coef = "(sstatus)|(movstatus)|(univ)|(quintile_miss)|(age)|(sex)")
# Chunk 10
results_3_redist_macro_bvi_efectplot <- sjPlot::plot_model(results_3_redist_macro_bvi, type="std", title = "Modelo final con predictores, pendiente aleatoria e interaccion.")
ggsave(results_3_redist_macro_bvi_efectplot, filename = "output/results/results_3_redist_macro_bvi_efectplot.png", width = 10, height = 10, dpi= "retina")
graf2=ggpredict(results_2_redist_macro_bv, terms = c("merit","v5c [sample = 9]"), type="re")
pendiente_aleatoria_redistbv <- plot(graf2)
pendiente_aleatoria_redistbv
ggsave(pendiente_aleatoria_redistbv, filename = "output/results/pendiente_aleatoria_redistbv.png", width = 10, height = 10, dpi= "retina")
results_3_redist_macro_bvi_interacgini_meansd <- sjPlot::plot_model(results_3_redist_macro_bvi,
type = c("int"),
title = "Interaccion desigualdad",
mdrt.values = "meansd") +  scale_color_discrete("Gini Index", labels = c("- 1 DS", "Media", "+ 1 DS")) + theme(legend.position = "bottom") + ylab("Redistributive preferences") + xlab("Meritocratic perception")
results_3_redist_macro_bvi_interacgini_minmax <- sjPlot::plot_model(results_3_redist_macro_bvi,
type = c("int"),
title = "Interaccion desigualdad", terms = c ("merit [-3,2]")) +  scale_color_discrete("Gini Index", labels = c("Min", "Max")) + theme(legend.position = "bottom") + ylab("Redistributive preferences") + xlab("Meritocratic perception")
ggsave(plot_grid(list(results_3_redist_macro_bvi_efectplot, pendiente_aleatoria_redistbv,results_3_redist_macro_bvi_interacgini_meansd, results_3_redist_macro_bvi_interacgini_minmax) ,
margin = c(0.5,0.5,0.5,0.5),
tags = c(" ", " "," ", " ")),
filename = "output/results/results_3_redist_macro_bvi_interacgini.png", width = 10, height = 10, dpi= "retina")
#sjPlot::plot_model(results_3_redist_macro_bvi_2, type = c("int"), title = "Interaccion libertad economica",  mdrt.values = "meansd")
# Chunk 11
results_1_accum__1  = lmer(accum ~  gini_neto + fi_index + pibpc + 1 + (1| v5c), data = mer_pref, REML=F)
results_1_accum_3 = lmer(accum ~ merit + 1 +  (1| v5c), data = mer_pref, REML=F)
results_1_accum_4 = lmer(accum ~  merit + bmerit + 1 +  (1| v5c), data = mer_pref, REML=F)
results_1_accum_5 = lmer(accum ~  merit + bmerit + unmerit + 1 +  (1| v5c), data = mer_pref, REML=F)
results_1_accum_6 = lmer(accum ~ merit + bmerit + unmerit + need + 1 +  (1| v5c), data = mer_pref, REML=F)
results_1_accum_7 = lmer(accum ~ gini_neto + fi_index + pibpc  + merit + bmerit + unmerit + need + 1 +  (1| v5c), data = mer_pref, REML=F)
results_1_accum_8 = lmer(accum ~ gini_neto + fi_index + merit + bmerit + unmerit + need + sstatus + as.factor(movstatus) + 1 +  (1| v5c), data = mer_pref, REML=F)
results_1_accum_9 = lmer(accum ~ gini_neto + fi_index + merit + bmerit + unmerit + need + sstatus + as.factor(movstatus) + univ + as.factor(quintile_miss)  + sex + age  + 1 +  (1| v5c), data = mer_pref, REML=F)
results_1_accum_macro = lmer(accum ~ univ + as.factor(quintile_miss) +	sstatus + as.factor(movstatus) + sex + age  + merit + bmerit + unmerit + need + gini_neto + fi_index + pibpc + 1 +  (1| v5c), data = mer_pref, REML=F)
results_2_accum_macro_bv = lmer(accum ~ univ + as.factor(quintile_miss) +	sstatus + as.factor(movstatus) + sex + age  + merit + bmerit + unmerit + need +  gini_neto + fi_index + pibpc + 1 +  (1 + merit| v5c), data = mer_pref, REML=F)
results_3_accum_macro_bvi = lmer(accum ~ univ + as.factor(quintile_miss) +	sstatus + as.factor(movstatus) + sex + age  + merit + bmerit + unmerit + need +  gini_neto + merit*fi_index + pibpc + 1 +  (1 + merit| v5c), data = mer_pref, REML=F)
results_3_accum_macro_bvi_2 = lmer(accum ~ univ + as.factor(quintile_miss) +	sstatus + as.factor(movstatus) + sex + age  + merit + bmerit + unmerit + need +  fi_index + merit*gini_neto + pibpc + 1 +  (1 + merit| v5c), data = mer_pref, REML=F)
#htmlreg(list(results_1_accum_macro,results_2_accum_macro_bv,results_3_accum_macro_bvi, results_3_accum_macro_bvi_2), star.symbol = "\\*")
# Chunk 12
htmlreg(list(results_1_accum__1, results_1_accum_3,results_1_accum_4,results_1_accum_5,results_1_accum_6,results_1_accum_7, results_2_accum_macro_bv, results_3_accum_macro_bvi),
caption = "Accumulation preferences models",
omit.coef = "(sstatus)|(movstatus)|(univ)|(quintile_miss)|(age)|(sex)",
custom.coef.names = c("Intercept", "Gini index" , "Economic freedom index",  "PIB per capita" , "Meritocratic perception",
"Meritocratic preference", "Unmeritocratic Perception","Unmerit preference", "Economic-freedom Merit-perception"),
caption.above = T,
star.symbol = "\\*",
center = T,
custom.note = "$***p <$ 0.001, $**p <$ 0.01, $*p <$ 0.05 <br> Since Model 6 control by subjetive status, mov subjetive status, Ed.univ, quintile_miss, age and sex")
# Chunk 13
results_3_accum_macro_bvi_efect <- sjPlot::plot_model(results_3_accum_macro_bvi, type="std", title = "Modelo de pendiente aleatoria e interaccion (desigualdad)")
ggsave(results_3_accum_macro_bvi_efect, filename = "output/results/results_3_accum_macro_bvi_efect.png", width = 10, height = 10, dpi= "retina")
graf2=ggpredict(results_2_accum_macro_bv, terms = c("merit","v5c [sample = 9]"), type="re")
pendientealeatoria_accum <- plot(graf2)
ggsave(pendientealeatoria_accum, filename = "output/results/pendientealeatoria_accum.png", width = 10, height = 10, dpi= "retina")
mer_accum_int_f1 <- sjPlot::plot_model(results_3_accum_macro_bvi_2,
type = c("int"),
title = "Interaccion Desigualdad",
mdrt.values = "meansd") +  scale_color_discrete("Gini Index", labels = c("- 1 DS", "Media", "+ 1 DS")) + ylab("Accumulation preferences") + xlab("Meritocratic perception")
mer_accum_int_f2 <- sjPlot::plot_model(results_3_accum_macro_bvi_2,
type = c("int"),
title = "Interaccion Desigualdad") +  scale_color_discrete("Freedom Economic Index", labels = c("Min", "Max")) + ylab("Accumulation preferences") + xlab("Meritocratic perception")
ggsave(mer_accum_int_f1, filename = "output/results/mer_accum_int_f1.png", width = 10, height = 10, dpi= "retina")
ggsave(plot_grid(list(results_3_accum_macro_bvi_efect, pendientealeatoria_accum,mer_accum_int_f1, mer_accum_int_f2) ,
margin = c(0.5,0.5,0.5,0.5), tags = c(" ", " "," ", " ")),
filename = "output/results/results_3_accum_macro_bvi_interacgini.png", width = 10, height = 10, dpi= "retina")
#summary(mer_pref$merit) No se puede ampliar el rango del grafico por que ese es el rango de la variable.
# Chunk 14
# guardar tablas
#redis
save(results_1_redist_macro, file = "output/results/results_1_redist_macro.rdata")
save(results_2_redist_macro_bv, file = "output/results/results_2_redist_macro_bv.rdata")
save(results_3_redist_macro_bvi, file = "output/results/results_3_redist_macro_bvi.rdata")
#accum
save(results_1_accum_macro, file = "output/results/results_1_accum_macro.rdata")
save(results_2_accum_macro_bv, file = "output/results/results_2_accum_macro_bv.rdata")
save(results_3_accum_macro_bvi, file = "output/results/results_3_accum_macro_bvi.rdata")
# Chunk 15
results_1_redist__1r  = lmer(redist ~  redis_relativo + fi_index + pibpc + 1 + (1| v5c), data = mer_pref, REML=F)
results_1_redist_3r = lmer(redist ~ merit + 1 +  (1| v5c), data = mer_pref, REML=F)
results_1_redist_4r = lmer(redist ~  merit + bmerit + 1 +  (1| v5c), data = mer_pref, REML=F)
results_1_redist_5r = lmer(redist ~  merit + bmerit + unmerit + 1 +  (1| v5c), data = mer_pref, REML=F)
results_1_redist_6r = lmer(redist ~ merit + bmerit + unmerit + need + 1 +  (1| v5c), data = mer_pref, REML=F)
results_1_redist_7r = lmer(redist ~ redis_relativo + fi_index + pibpc + merit + bmerit + unmerit + need + 1 +  (1| v5c), data = mer_pref, REML=F)
results_1_redist_9r = lmer(redist ~ redis_relativo + fi_index + pibpc + merit + bmerit + unmerit + need + sstatus + as.factor(movstatus) + univ + as.factor(quintile_miss)  + sex + age  + 1 +  (1| v5c), data = mer_pref, REML=F)
results_2_redist_macro_bvr = lmer(redist ~ univ + as.factor(quintile_miss) +	sstatus + as.factor(movstatus) + sex + age  + merit + bmerit + unmerit + need + redis_relativo + fi_index + pibpc + 1 +  (1 + merit| v5c), data= mer_pref, REML=F)
results_3_redist_macro_bvir = lmer(redist ~ univ + as.factor(quintile_miss) +	sstatus + as.factor(movstatus) + sex + age  + merit + bmerit + unmerit + need + merit*redis_relativo + fi_index + pibpc  + 1 +  (1 + merit| v5c), data = mer_pref, REML=F)
# Chunk 16
htmlreg(list(results_1_redist__1r, results_1_redist_3r,results_1_redist_4r,results_1_redist_5r,results_1_redist_6r,results_1_redist_7r, results_1_redist_9r, results_2_redist_macro_bvr, results_3_redist_macro_bvir),
caption = "Redistributive preference models",
omit.coef = "(sstatus)|(movstatus)|(univ)|(quintile_miss)|(age)|(sex)",
custom.coef.names = c("Intercept", "Redistribution", "Economic freedom index", "PIB per capita", "Meritocratic perception",
"Meritocratic preference", "Unmeritocratic Perception","Unmerit preference", "Redistribution x Merit-perception"),
caption.above = T,
star.symbol = "\\*",
center = T,
custom.note = "$***p <$ 0.001, $**p <$ 0.01, $*p <$ 0.05 <br> Since Model 6 control by subjetive status, mov subjetive status, Ed.univ, quintile_miss, age and sex")
# Chunk 17
mer_pref_sinnonconvr<- mer_pref[which(mer_pref$v5c!='VEN'), ]
mer_pref_sinnonconvr<- mer_pref_sinnonconvr[which(mer_pref_sinnonconvr$v5!=191), ]
mer_pref_sinnonconvr <- mer_pref_sinnonconvr[which(mer_pref_sinnonconvr$v5c!='CYP'), ]
mer_pref_sinnonconvr <- mer_pref_sinnonconvr[which(mer_pref_sinnonconvr$v5!=380), ]
mer_pref_sinnonconvr <- mer_pref_sinnonconvr[which(mer_pref_sinnonconvr$v5!=428), ]
results_3_redist_macro_bvi_nocong = lmer(redist ~ univ + as.factor(quintile_miss) +    sstatus + as.factor(movstatus) + sex + age  + merit + bmerit + unmerit + need + merit*gini_neto + fi_index + pibpc + 1 +  (1 + merit| v5c), data = mer_pref_sinnonconvr, REML=F)
results_3_accum_macro_bvi_nocong = lmer(accum ~ univ + as.factor(quintile_miss) +  sstatus + as.factor(movstatus) + sex + age  + merit + bmerit + unmerit + need +  gini_neto + merit*fi_index  + pibpc + 1 +  (1 + merit| v5c), data = mer_pref_sinnonconvr, REML=F)
# Chunk 18
htmlreg(list(results_3_redist_macro_bvi, results_3_redist_macro_bvi_nocong, results_3_accum_macro_bvi, results_3_accum_macro_bvi_nocong),
caption = "Comparison model excludig countries non convergent in the measurement",
custom.model.names = c("Whit", "Whithout","Whit", "Whithout"),
custom.header = list("Redistributive" = 1:2, "Accumulation" = 3:4),
star.symbol = "\\*",
custom.note = "$***p <$ 0.001, $**p <$ 0.01, $*p <$ 0.05 <br> countries non convergent in the measurement model:Venezuela, Croatia, Cyprus, Italy, Latvia",
custom.coef.names = c("Intercept", "University. Ed.", "Quintile 2", "Quintile 3", "Quintile 4","Quintile 5", "Quintile miss", "Subjetive status",
"Subjetive upward mobility", "Supjetive downward mobility","Subjetive non-mobility","Gender", "Age", "Meritorcatic perception",
"Meritocratic preferences", "Unmeritocratic perception", "Unmeritocratic preferences", "Gini index", "Economic freedom index", "PIB per capita",
"Merit-perception x Gini", "Merit-perception x Economic-freedom"),
caption.above = T)
# Chunk 19
#Redis
estex.m23_2a <- influence.ME::influence(results_3_redist_macro_bvi, "v5c")
plota <- plot(estex.m23_2a, which="cook",
cutoff = .1, sort = TRUE,
xlab = "Cooks Distance Redistributive Model",
ylab="Contries")
estex.m23_2b <-  influence.ME::influence(results_3_accum_macro_bvi, "v5c")
plotb <-plot(estex.m23_2b, which="cook",
cutoff = .1, sort = TRUE,
xlab = "Cooks Distance Accumulation Model",
ylab="Contries")
# Chunk 20
mer_pref_sininfl <- mer_pref[which(mer_pref$v5c!='ZAF'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='CYP'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='TUR'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='TWN'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='UKR'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='CZE'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='FRA'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='AUS'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='DNK'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='USA'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='VEN'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='PHL'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='POL'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='CHN'), ]
results_3_redist_macro_bvi_sininf = lmer(redist ~ univ + as.factor(quintile_miss) +	sstatus + as.factor(movstatus) + sex + age  + merit + bmerit + unmerit + need + merit*gini_neto + fi_index + 1 +  (1 + merit| v5c), data = mer_pref_sininfl, REML=F)
mer_pref_sininfl <- mer_pref[which(mer_pref$v5c!='ZAF'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='VEN'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='FRA'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='CHN'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='UKR'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='ISR'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='CHL'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='AUS'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='DNK'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='LVA'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='VEN'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='PHL'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='POL'), ]
mer_pref_sininfl <- mer_pref_sininfl[which(mer_pref_sininfl$v5c!='CZE'), ]
results_3_accum_macro_bvi_sininfl = lmer(accum ~ univ + as.factor(quintile_miss) +	sstatus + as.factor(movstatus) + sex + age  + merit + bmerit + unmerit + need +  gini_neto + merit*fi_index + pibpc + 1 +  (1 + merit| v5c), data = mer_pref_sininfl, REML=F)
# Chunk 21
htmlreg(list(results_3_redist_macro_bvi, results_3_redist_macro_bvi_sininf,results_3_accum_macro_bvi, results_3_accum_macro_bvi_sininfl),
caption = "Comparison model Without influential cases in level two",
custom.model.names = c("Whit", "Whithout","Whit", "Whithout"),
custom.header = list("Redistributive" = 1:2, "Accumulation" = 3:4),
caption.above = T,
star.symbol = "\\*",
custom.note = "$***p <$ 0.001, $**p <$ 0.01, $*p <$ 0.05 <br> Influential contries: CYP, TUR, TWN, UKR,CZE, FRA, AUS, DNK, USA, VEN,PHL, POL, CHN, ISR, CHL, LVA, PHL",
custom.coef.names = c("Intercept", "University. Ed.", "Quintile 2", "Quintile 3", "Quintile 4","Quintile 5", "Quintile miss", "Subjetive status",
"Subjetive upward mobility", "Supjetive downward mobility" ,"Subjetive non-mobility","Gender", "Age", "Meritorcatic perception",
"Meritocratic preferences", "Unmeritocratic perception", "Unmeritocratic preferences", "Gini index", "Economic freedom index", "PIB per capita",
"Merit-perception x Gini", "Merit-perception x Economic-freedom"))
# Chunk 22
mer_pref$merit_g = as.numeric(mer_pref$merit - mer_pref$j_merit)
mer_pref$bmerit_g = as.numeric(mer_pref$bmerit - mer_pref$j_bmerit)
mer_pref$unmerit_g = as.numeric(mer_pref$unmerit - mer_pref$j_unmerit)
mer_pref$need_g = as.numeric(mer_pref$need - mer_pref$j_need)
results_1_redist__1  = lmer(redist ~  gini_neto + fi_index + pibpc + 1 + (1| v5c), data = mer_pref, REML=F)
results_1_redist_3 = lmer(redist ~ merit_g + 1 +  (1| v5c), data = mer_pref, REML=F)
results_1_redist_4 = lmer(redist ~  merit_g + bmerit_g + 1 +  (1| v5c), data = mer_pref, REML=F)
results_1_redist_5 = lmer(redist ~  merit_g + bmerit_g + unmerit_g + 1 +  (1| v5c), data = mer_pref, REML=F)
results_1_redist_6 = lmer(redist ~ merit_g + bmerit_g + unmerit_g + need_g + 1 +  (1| v5c), data = mer_pref, REML=F)
results_1_redist_7 = lmer(redist ~ gini_neto + fi_index + pibpc + merit_g + bmerit_g + unmerit_g + need_g + 1 +  (1| v5c), data = mer_pref, REML=F)
results_1_redist_9 = lmer(redist ~ gini_neto + fi_index + pibpc + merit_g + bmerit_g + unmerit_g + need_g + sstatus + as.factor(movstatus) + univ + as.factor(quintile_miss)  + sex + age  + 1 +  (1| v5c), data = mer_pref, REML=F)
results_2_redist_macro_bv = lmer(redist ~ univ + as.factor(quintile_miss) +	sstatus + as.factor(movstatus) + sex + age  + merit_g + bmerit_g + unmerit_g + need_g + gini_neto + fi_index + pibpc + 1 +  (1 + merit| v5c), data= mer_pref, REML=F)
results_3_redist_macro_bvi = lmer(redist ~ univ + as.factor(quintile_miss) +	sstatus + as.factor(movstatus) + sex + age  + merit_g + bmerit_g + unmerit_g + need_g + merit_g*gini_neto + fi_index + pibpc + 1 +  (1 + merit_g | v5c), data = mer_pref, REML=F)
# Chunk 23
htmlreg(list(results_1_redist__1, results_1_redist_3,results_1_redist_4,results_1_redist_5,results_1_redist_6,results_1_redist_7, results_1_redist_9, results_2_redist_macro_bv, results_3_redist_macro_bvi),
caption = "Redistributive preference models",
omit.coef = "(sstatus)|(movstatus)|(univ)|(quintile_miss)|(age)|(sex)",
custom.coef.names = c("Intercept", "Gini index", "Economic freedom index", "PIB per capita", "Meritocratic perception",
"Meritocratic preference", "Unmeritocratic Perception","Unmerit preference", "GINI x Merit-perception"),
caption.above = T,
star.symbol = "\\*",
center = T,
custom.note = "$***p <$ 0.001, $**p <$ 0.01, $*p <$ 0.05 <br> Since Model 6 control by subjetive status, mov subjetive status, Ed.univ, quintile_miss, age and sex")
# Chunk 24
results_1_accum__1  = lmer(accum ~  gini_neto + fi_index + pibpc + 1 + (1| v5c), data = mer_pref, REML=F)
results_1_accum__2  = lmer(accum ~  gini_neto + fi_index + pibpc + 1 + (1| v5c), data = mer_pref, REML=F)
results_1_accum_3 = lmer(accum ~ merit_g + 1 +  (1| v5c), data = mer_pref, REML=F)
results_1_accum_4 = lmer(accum ~  merit_g + bmerit_g + 1 +  (1| v5c), data = mer_pref, REML=F)
results_1_accum_5 = lmer(accum ~ merit_g + bmerit_g + unmerit_g + 1 +  (1| v5c), data = mer_pref, REML=F)
results_1_accum_6 = lmer(accum ~ merit_g + bmerit_g + unmerit_g + need_g + 1 +  (1| v5c), data = mer_pref, REML=F)
results_1_accum_7 = lmer(accum ~ gini_neto + fi_index + pibpc  + merit_g + bmerit_g + unmerit_g + need_g + 1 +  (1| v5c), data = mer_pref, REML=F)
results_1_accum_8 = lmer(accum ~ gini_neto + fi_index + pibpc  + bmerit_g + unmerit_g + need_g + sstatus + as.factor(movstatus) + 1 +  (1| v5c), data = mer_pref, REML=F)
results_1_accum_9 = lmer(accum ~ gini_neto + fi_index + pibpc  + merit_g + bmerit_g + unmerit_g + need_g + sstatus + as.factor(movstatus) + univ + as.factor(quintile_miss)  + sex + age  + 1 +  (1| v5c), data = mer_pref, REML=F)
results_1_accum_macro = lmer(accum ~ univ + as.factor(quintile_miss) +	sstatus + as.factor(movstatus) + sex + age  + merit_g + bmerit_g + unmerit_g + need_g + gini_neto + fi_index + 1 +  (1| v5c), data = mer_pref, REML=F)
results_2_accum_macro_bv = lmer(accum ~ gini_neto + fi_index + pibpc + univ + as.factor(quintile_miss) +	sstatus + as.factor(movstatus) + sex + age  + merit_g + bmerit_g + unmerit_g + need_g +  gini_neto + fi_index + 1 +  (1 + merit_g| v5c), data = mer_pref, REML=F)
results_3_accum_macro_bvi = lmer(accum ~ gini_neto + fi_index + pibpc + univ + as.factor(quintile_miss) +	sstatus + as.factor(movstatus) + sex + age  + merit_g + bmerit_g + unmerit_g + need_g + merit_g*fi_index + 1 +  (1 + merit_g| v5c), data = mer_pref, REML=F)
results_3_accum_macro_bvi_2 = lmer(accum ~ gini_neto + fi_index + pibpc + univ + as.factor(quintile_miss) +	sstatus + as.factor(movstatus) + sex + age  + merit_g + bmerit_g + unmerit_g + need_g +  merit_g*gini_neto + 1 +  (1 + merit_g| v5c), data = mer_pref, REML=F)
#htmlreg(list(results_1_accum_macro,results_2_accum_macro_bv,results_3_accum_macro_bvi, results_3_accum_macro_bvi_2), star.symbol = "\\*")
# Chunk 25
htmlreg(list(results_1_accum__1, results_1_accum_3,results_1_accum_4,results_1_accum_5,results_1_accum_6,results_1_accum_7, results_2_accum_macro_bv, results_3_accum_macro_bvi),
caption = "Accumulation preferences models",
omit.coef = "(sstatus)|(movstatus)|(univ)|(quintile_miss)|(age)|(sex)",
custom.coef.names = c("Intercept", "Gini index" , "Economic freedom index",  "PIB per capita" , "Meritocratic perception",
"Meritocratic preference", "Unmeritocratic Perception","Unmerit preference", "Economic-freedom Merit-perception"),
caption.above = T,
star.symbol = "\\*",
center = T,
custom.note = "$***p <$ 0.001, $**p <$ 0.01, $*p <$ 0.05 <br> Since Model 6 control by subjetive status, mov subjetive status, Ed.univ, quintile_miss, age and sex")
hist(mer_pref$goveffect)
source('~/GitHub/meritocracy-preferences/render-site.R', echo=TRUE)
